import { useEffect, useRef } from "react";
import { gsap } from "gsap/dist/gsap";
import { MorphSVGPlugin } from "gsap/dist/MorphSVGPlugin";
gsap.registerPlugin(MorphSVGPlugin);

let hasAnimated = false;
const maintl = gsap.timeline({ repeat: -1, yoyo: true });
const Peekabo = ({ id, className }) => {

   useEffect(() => {

      // Only run animation once
      if (hasAnimated) return;
      hasAnimated = true;

      // GSAP animation code goes here
      maintl

         // Frame 1
         .add("frame1", 0)
         .set(".guide", { autoAlpha: 0 }, "frame1")

         .add("frame2", "+=0")
         .from("#opening", 1, { ease: "power4.inOut", morphSVG: { shape: "#opening-start", shapeIndex: "auto" } }, "frame2")
         .from("#wrinkle1", 1, { y: 15, rotation: -10,  ease: "power3.inOut", morphSVG: { shape: "#wrinkle1-start", shapeIndex: "auto" } }, "frame2")
         .from("#wrinkle2", 1, {y: -15, rotation: -10,  ease: "power3.inOut", morphSVG: { shape: "#wrinkle2-start", shapeIndex: "auto" } }, "frame2")
         .from("#hand", 1, { x: 130, y: 20, ease: "power4.inOut"}, "frame2")
         .from("#eyes", 1, { x: 80, y: -20, scale:.5, transformOrigin: "center", ease: "power4.inOut"}, "frame2")

         .add("frame3", "+=0")
         .from("#bubble", .5, { scale: 0, rotation:15, transformOrigin: "bottom right", ease: "back.out(1.7)" }, "frame3")

         .add("frame4", "+=1")
         .set("#eye-R, #eye-L", { scaleY:.1, transformOrigin: "center", ease: "power4.inOut"}, "frame4")
         .set("#eye-R, #eye-L", { scaleY:1, transformOrigin: "center", ease: "power4.inOut"}, "frame4+=0.2")
         .set("#eye-R, #eye-L", { scaleY:.1, transformOrigin: "center", ease: "power4.inOut"}, "frame4+=0.3")
         .set("#eye-R, #eye-L", { scaleY:1, transformOrigin: "center", ease: "power4.inOut"}, "frame4+=0.4")

         .add("frameEND", "+=1")
         .set(".guide", { autoAlpha: 1 }, "frameEND")
         })

   return (
      <div id={id} className={`peekabo-container ${className}`}>
         <svg id="peekabo" xmlns="http://www.w3.org/2000/svg" width="214.38" height="367.63" viewBox="0 0 214.38 367.63">
            <g id="start-state">
               <path id="opening-start" className="guide" d="M213.12,184.23c.13-16.01.43-50,.65-65.34.15-10.61.34-26.71.45-39.79.06-7.72.1-16.44.17-23.72v312c-.02,2.46-.57-13.48-.61-16.49-.27-19.21-.51-30.25-.68-55.84-.16-23.85-.22-54.72-.2-82.63.02-3.22.18-17.75.22-28.19Z" />
               <path id="wrinkle2-start" className="guide" d="M210.4,340.96c-.38-1.61-.75-4.94-1.06-7.76-1.28-11.49-2.51-25.84-2.5-44.64l.43,12.15c.69,16.34,1.94,28.05,3.13,40.25Z" style={{ opacity: .66 }} />
               <path id="wrinkle1-start" className="guide" d="M210.12,129.05c.08,2.77-.41,17.99-.5,20.38-1.09,31.08-2.8,47.64-3.21,95.74-.12,14.62-.1,23.3-.04,37.91,0,1.87,0,1.37-.06,1.34-.39-41.77-.05-69.23,1.08-93.62.87-18.78,1.55-27.63,2.35-51.78.11-3.45.2-8.62.37-9.97Z" style={{ opacity: .65 }} />
            </g>
            <g id="end-state">
               <path id="opening" d="M112.23,164.36c10.8-16.01,35.07-30,52.17-45.34,11.83-10.61,27.37-26.71,36.21-39.79,5.22-7.72,8.26-16.44,13.78-23.72v312c-1.81,2.46-45.6-33.48-49.01-36.49-21.8-19.21-40.98-40.25-55.16-65.84-13.21-23.85-17.57-44.72-15.88-72.63,1.44-3.22,14.57-17.75,17.89-28.19Z" />
               <g id="hand">
                  <path d="M94.35,192.55c-9.91-7.43-19.49-4.81-18.96-7.53-.14-3.44,7.81-4.19,21,.48-8.32-9.7-15.92-8.26-17.36-10.49s2.26-3.57,5.9-2.79c4.72,1,16.46,6,16.9,6.17-8.31-11.83-18.77-11.86-16.9-13.57,1.73-1.9,4.13-4.43,22.79,5.42-2.89-6.91-11.39-8.04-10.33-9.72.2-1.78,7.35-1.15,14.84,4,7.68,7.13-3.5,34.24-17.89,28.04Z" />
               </g>
               <g id="eyes">
                  <path id="whites" d="M142.15,213.72c7.86-1.28,12.37,3.43,15.74,9.77,25.28-28.18,46.95,15.71,27.47,34.49-10.7,10.32-25.54,6.59-31.54-7.46-29.18,24.38-33.6-33.24-11.68-36.8Z" style={{ fill: "#fff" }} />
                  <path id="eye-R" d="M172.79,243.3c-5.2,10.08-16.26-2.31-11.99-11.55,4.75-10.29,17.77.35,11.99,11.55Z" />
                  <path id="eye-L" d="M152.17,240.69c-8.75,6.15-13.01-13.49-1.86-15.03,6.8,1.21,6.49,11.77,1.86,15.03Z" />
               </g>
               <path id="wrinkle2" d="M165.4,351.5c-9-3.63-17.59-11.13-25.01-17.48-30.24-25.86-59.1-58.17-58.98-100.51l10.13,27.35c16.2,36.78,45.79,63.16,73.86,90.63Z" style={{ opacity: .66 , fill: "#001428"}} />
               <path id="wrinkle1" d="M181.39,75.51c2.62,2.93-13.29,18.99-15.98,21.51-35.09,32.8-89.91,50.29-102.94,101.06-3.96,15.43-3.11,24.59-1.14,40.01.25,1.97-.23,1.44-1.92,1.41-12.37-44.09-1.74-73.07,34.68-98.82,28.04-19.83,49.9-29.17,75.34-54.66,3.63-3.64,6.3-9.1,11.97-10.52Z" style={{ opacity: .65 , fill: "#001428"}} />
            </g>
            <g id="bubble">
               <g id="bubble-fill">
                  <path d="M182.59,134.62c0-.74-.44-.77-1.59-.18-1.56.79-4.03,1.03-5.97.59-2.68-.59-4.92-3.06-11.15-12.36-2.85-4.3-6.18-9.18-7.33-10.89-1.15-1.71-4.21-6.21-6.77-10.01-12.07-17.89-16.45-24.31-16.78-24.72-.24-.24-.47-.79-.59-1.21-.18-.71.15-1.09,3.27-3.97,1.88-1.77,4.59-4.27,5.97-5.56,5-4.65,6.45-6.77,8.33-12.21.94-2.74.97-2.91.97-7.8,0-4.33-.09-5.3-.68-7.3-1.27-4.41-3.3-8.03-6.83-12.18-8.36-9.83-26.49-18.01-47.68-21.54-9.98-1.65-16.98-2.06-24.72-1.5-12.86.97-26.72,4.15-38.2,8.77-15.01,6.09-25.08,14.95-28.34,25.08-.79,2.38-.94,3.38-1.09,6.86-.29,7.74.97,11.45,6.03,17.81,4.56,5.71,10.86,11.42,16.13,14.54,6.42,3.83,14.48,6.83,23.43,8.74,9.62,2.06,17.75,2.77,31.61,2.8,12.07.03,12.63-.03,19.25-1.91,5.09-1.47,9.89-2,12.89-1.47,2.8.5,7.71,2.91,12.86,6.33,17.95,11.89,39.53,35.49,42.44,46.44.77,2.94.38,5.68-1.24,8.36-.56.91-.97,1.71-.94,1.74.06.06.91.5,1.91,1,2.21,1.09,3.53,2.35,4.8,4.59.91,1.56,1,1.65,1.88,1.47.5-.12,1.82-.62,2.97-1.12,2.24-1.03,4.36-1.21,8.45-.71l2,.26-.44-.85c-.5-.94-.59-4.56-.18-6.39.15-.62.68-1.77,1.18-2.56l.88-1.44-.94-.47c-2.27-1.18-5.8-5.44-5.8-7Z" style={{ fill: "#fff" }} />
               </g>
               <path id="bubble-outline" d="M199.4,140.39c-.12-.24-1.88-.74-3.86-1.15-5.47-1.09-8.21-2.3-9.04-3.91-.26-.5-.38-2.47-.38-6.42,0-3.68-.12-5.65-.29-5.65s-.77.18-1.3.41c-.82.35-1.21.82-2.09,2.74-2.18,4.71-2.38,4.97-4.36,5.3-1.44.24-2.88-.56-4.59-2.53-.77-.91-8.89-12.66-17.98-26.08-16.92-24.93-18.25-26.9-18.25-27.22,0-.09,1.47-1.44,3.27-2.97,7.3-6.18,11.42-12.04,13.27-18.81.59-2.18.68-3.18.68-7.95s-.09-5.74-.68-7.95c-3-11.01-11.68-20.28-25.19-26.9C115.78,5.03,102.01,1.65,82.97.15c-2.83-.24-9.8-.18-14.27.09-15.63,1-28.2,4.09-39.59,9.77-8.51,4.24-13.92,8.15-20.07,14.42-4.8,4.94-6.56,8.01-8.27,14.33-.62,2.44-.74,3.47-.77,7.39,0,2.5.18,5.39.35,6.39,2.27,11.27,11.13,21.13,25.22,28.05,10.74,5.3,23.57,8.74,39.59,10.62,4.68.56,7.03.68,16.63.68l11.18.03,3.24-.79c1.77-.44,4.41-1.15,5.89-1.56,3.71-1.03,8.74-1.53,10.83-1.06,3,.68,7.8,3.41,13.6,7.77,14.39,10.83,32.64,30.76,37.26,40.67,1.09,2.3,1.47,5.03.85,6.18-.38.74-1.97,1.53-5.3,2.65-3,1-4.21,2.41-3.18,3.74.26.32,1.65.71,4.06,1.12,4.41.77,6.47,1.65,7.68,3.3,1.06,1.47,1.38,2.56,1.8,6.03l.32,2.74h.88c.74,0,1.44-.53,3.86-2.91,2-1.91,3.38-3,4.12-3.27,1.91-.62,5.97-.24,9.74.97,1.77.56,4.06,1.12,5.09,1.24l1.82.21v-1.24c0-1.09-.24-1.47-2.06-3.62-2.47-2.88-3.21-4.65-2.68-6.45.47-1.5,1.91-2.53,5.39-3.77,1.5-.53,2.91-1.09,3.09-1.27.44-.32.5-1.62.12-2.21ZM188.45,143.54c-.5.79-1.03,1.94-1.18,2.56-.41,1.82-.32,5.44.18,6.39l.44.85-2-.26c-4.09-.5-6.21-.32-8.45.71-1.15.5-2.47,1-2.97,1.12-.88.18-.97.09-1.88-1.47-1.27-2.24-2.59-3.5-4.8-4.59-1-.5-1.85-.94-1.91-1-.03-.03.38-.82.94-1.74,1.62-2.68,2-5.42,1.24-8.36-2.91-10.95-24.49-34.55-42.44-46.44-5.15-3.41-10.07-5.83-12.86-6.33-3-.53-7.8,0-12.89,1.47-6.62,1.88-7.18,1.94-19.25,1.91-13.86-.03-21.99-.74-31.61-2.8-8.95-1.91-17.01-4.92-23.43-8.74-5.27-3.12-11.57-8.83-16.13-14.54-5.06-6.36-6.33-10.07-6.03-17.81.15-3.47.29-4.47,1.09-6.86,3.27-10.12,13.33-18.98,28.34-25.08,11.48-4.62,25.34-7.8,38.2-8.77,7.74-.56,14.75-.15,24.72,1.5,21.19,3.53,39.32,11.71,47.68,21.54,3.53,4.15,5.56,7.77,6.83,12.18.59,2,.68,2.97.68,7.3,0,4.89-.03,5.06-.97,7.8-1.88,5.44-3.33,7.56-8.33,12.21-1.38,1.29-4.09,3.8-5.97,5.56-3.12,2.88-3.44,3.27-3.27,3.97.12.41.35.97.59,1.21.32.41,4.71,6.83,16.78,24.72,2.56,3.8,5.62,8.3,6.77,10.01,1.15,1.71,4.47,6.59,7.33,10.89,6.24,9.3,8.48,11.77,11.15,12.36,1.94.44,4.41.21,5.97-.59,1.15-.59,1.59-.56,1.59.18,0,1.56,3.53,5.83,5.8,7l.94.47-.88,1.44Z" />
               <g id="bubble-text">
                  <path d="M13.92,28.08c3.25-.97,5.93-1.45,8.02-1.45,2.82,0,4.21.98,4.19,2.94-.02,2.82-1.79,5.64-5.31,8.48.31.79,1.52,3.29,3.63,7.49-1.08.99-2.71,2.45-4.88,4.39l-3.37-8.61c-.53,2.73-.92,5.25-1.19,7.56l-4.88,1.39c.04-.46.26-1.85.66-4.16l3.14-18.02ZM17.85,33.03c-.2.7-.37,1.42-.53,2.15l-.43,2.11c.75-.37,1.47-.86,2.18-1.45.84-.73,1.38-1.41,1.62-2.05.09-.2.14-.37.17-.53-.02-.46-.33-.69-.92-.69-.48,0-1.18.15-2.08.46Z" />
                  <path d="M33.19,32.8c-.15.59-.3,1.19-.43,1.78l-.33,1.72,5.02-1.06-.3,4.32c-2.4.4-4.27.76-5.61,1.09-.09.42-.17.84-.23,1.25l-.23,1.22,5.84-.86-.4,5.81c-3.01.26-6.82.99-11.42,2.18l3.73-22.44,10.36-1.52-.4,5.81c-2.02.18-3.89.41-5.61.69Z" />
                  <path d="M37.45,50.42c2.79-7.15,4.92-14.42,6.37-21.81l7.49-1.22-1.06,11.52,2.9-10.63,7.19-1.25c-.84,6.8-1.27,12.94-1.29,18.41.02,1.08.03,2.16.03,3.23l-6.4,1.12,1.12-13.73-4.09,15.18-3.5.5,2.15-19.31-4.49,17.09-6.43.89Z" />
                  <path d="M68.64,32.8c-.15.59-.3,1.19-.43,1.78l-.33,1.72,5.02-1.06-.3,4.32c-2.4.4-4.27.76-5.61,1.09-.09.42-.17.84-.23,1.25l-.23,1.22,5.84-.86-.4,5.81c-3.01.26-6.82.99-11.42,2.18l3.73-22.44,10.36-1.52-.4,5.81c-2.02.18-3.89.41-5.61.69Z" />
                  <path d="M72.89,50.42c2.79-7.15,4.92-14.42,6.37-21.81l7.49-1.22-1.06,11.52,2.9-10.63,7.19-1.25c-.84,6.8-1.27,12.94-1.29,18.41.02,1.08.03,2.16.03,3.23l-6.4,1.12,1.12-13.73-4.09,15.18-3.5.5,2.15-19.31-4.49,17.09-6.43.89Z" />
                  <path d="M98.76,28.21c.66-.11,1.89-.38,3.7-.82,1.61-.4,2.88-.64,3.83-.73.4-.02.77-.03,1.12-.03,2.75,0,4.1.98,4.06,2.94.02,2.77-1.68,5.54-5.12,8.32,2.16-.13,3.39.47,3.7,1.81.09.31.12.62.1.92.02,1.56-.73,3.15-2.24,4.75-1.12,1.23-2.53,2.32-4.22,3.27-2.02,1.12-4.36,1.68-7,1.68-.42,0-.83-.01-1.22-.03.79-4.29,1.69-10.04,2.71-17.26.26-2.05.46-3.65.59-4.82ZM102.03,41.25c-.15.79-.33,1.86-.53,3.2,2.95-.88,4.42-1.9,4.42-3.07,0-.4-.36-.59-1.09-.59-.66,0-1.6.15-2.81.46ZM103.78,32.86c-.18.68-.34,1.36-.5,2.05l-.43,2.08c1.52-.95,2.61-2.03,3.27-3.27.11-.26.19-.48.23-.66,0-.35-.28-.53-.83-.53-.42,0-1,.11-1.75.33Z" />
                  <path d="M118.83,32.8c-.15.59-.3,1.19-.43,1.78l-.33,1.72,5.02-1.06-.3,4.32c-2.4.4-4.27.76-5.61,1.09-.09.42-.17.84-.23,1.25l-.23,1.22,5.84-.86-.4,5.81c-3.01.26-6.82.99-11.42,2.18l3.73-22.44,10.36-1.52-.4,5.81c-2.02.18-3.89.41-5.61.69Z" />
                  <path d="M127.64,28.08c3.26-.97,5.93-1.45,8.02-1.45,2.82,0,4.21.98,4.19,2.94-.02,2.82-1.79,5.64-5.31,8.48.31.79,1.52,3.29,3.63,7.49-1.08.99-2.71,2.45-4.88,4.39l-3.37-8.61c-.53,2.73-.92,5.25-1.19,7.56l-4.88,1.39c.04-.46.26-1.85.66-4.16l3.13-18.02ZM131.56,33.03c-.2.7-.37,1.42-.53,2.15l-.4,2.11c.73-.37,1.44-.86,2.14-1.45.84-.73,1.38-1.41,1.62-2.05.09-.2.14-.37.17-.53-.02-.46-.33-.69-.92-.69-.48,0-1.18.15-2.08.46Z" />
                  <path d="M40.75,59.8c-.15.57-.28,1.14-.36,1.72l-.4,1.68,5.48-1.16-.33,4.39c-2.13.33-4.15.72-6.04,1.15-.51,2.79-.9,5.56-1.19,8.28l-5.35,1.39,3.66-22.44,10.66-1.52-.36,5.81c-2.07.18-3.99.41-5.78.69Z" style={{ fill: "red" }} />
                  <path d="M49,55.11l5.38-.99c-1.5,5.79-2.65,11.12-3.46,16l5.48-.86-.46,5.81c-2.84.26-6.42.99-10.76,2.18l3.83-22.14Z" style={{ fill: "red" }} />
                  <path d="M56.29,77.62c3.06-7.81,5.52-15.36,7.39-22.64l9.54-1.58c-1.08,6.34-1.56,13.82-1.45,22.44l-6.7,1.55.46-3.93-2.05.4-.69,2.77-6.5.99ZM66.09,69.27l1.42-11.85h-.03l-2.97,12.14,1.58-.3Z" style={{ fill: "red" }} />
                  <path d="M87.64,60.66c-.66.26-1.45.57-2.38.92l-2.34.89c0-.97-.28-1.45-.82-1.45-.77,0-1.53.43-2.28,1.29-.57.66-.81,1.29-.73,1.88.07.4.46.59,1.19.59.4,0,.92-.05,1.58-.17.88-.2,1.67-.3,2.38-.3,1.74,0,2.75.6,3.04,1.81.11.37.17.77.17,1.19-.02,1.34-.53,2.78-1.52,4.32-1.3,2.02-3.12,3.73-5.48,5.12-1.23.73-2.44,1.09-3.63,1.09-1.08,0-2.15-.31-3.2-.92.55-1.23,1.4-3.07,2.54-5.51.66.44,1.36.66,2.11.66.33,0,.68-.04,1.06-.13.64-.18,1.25-.42,1.85-.73.84-.46,1.24-.94,1.22-1.42.02-.53-.4-.79-1.25-.79-.57,0-1.42.12-2.54.36-1.12.24-1.97.36-2.54.36-.77,0-1.37-.14-1.78-.43-.79-.55-1.12-1.4-.99-2.54.24-2.31,1.73-4.99,4.46-8.05,2.77-3.12,5.16-4.76,7.16-4.92,1.94-.11,2.92,1.35,2.94,4.39-.02.73-.09,1.55-.2,2.48Z" style={{ fill: "red" }} />
                  <path d="M91.21,55.11l5.78-.99c-1.06,3.98-1.9,7.61-2.54,10.89l2.61-.53,1.58-9.37,5.81-.99c-2.2,8.54-3.61,15.79-4.22,21.75l-5.35,1.39,1.42-8.51c-.59.13-1.48.32-2.67.56-.4,2.57-.67,4.76-.83,6.57l-5.35,1.39,3.76-22.14Z" style={{ fill: "red" }} />
                  <path d="M107.92,72.11c.73-.09,1.41.03,2.04.35.63.32.95.83.95,1.53-.02.97-.54,1.85-1.56,2.64-.8.62-1.67.99-2.62,1.12-.73.11-1.38.03-1.96-.23-.66-.35-.98-.88-.96-1.58-.02-.97.47-1.86,1.49-2.67.77-.64,1.65-1.02,2.62-1.16ZM105.64,55.08c3.26-.97,5.93-1.45,8.02-1.45,2.84,0,4.23.98,4.19,2.94-.02,2.49-1.36,4.96-4.03,7.43-1.47,1.34-3.88,3.04-7.23,5.08-.11-.42-.26-1.11-.45-2.06s-.24-1.64-.15-2.06c1.26-.48,2.48-1.07,3.67-1.75,1.69-1.01,2.57-1.92,2.64-2.74.04-.57-.47-.89-1.55-.96-1.12-.07-2.93.32-5.42,1.16l.3-5.58Z" />
               </g>
            </g>
         </svg>
      </div>
   )
};

export default Peekabo;