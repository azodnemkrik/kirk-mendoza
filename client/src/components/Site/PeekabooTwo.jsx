import { useEffect, useRef, useState } from "react";
import { gsap } from "gsap/dist/gsap";
import { MorphSVGPlugin } from "gsap/dist/MorphSVGPlugin";
gsap.registerPlugin(MorphSVGPlugin);

const PeekabooTwo = ({ id, className, onClick }) => {
	const [hasPlayed, setHasPlayed] = useState(false);
	const maintl = useRef(null);
	const touchTimer = useRef(null);

	useEffect(() => {
		// Create timeline only once
		if (maintl.current) return;

		// GSAP animation code goes here
		maintl.current = gsap.timeline({ paused: true })

			// Frame 1
			.add("frame1", 0)
			.set(".guide", { autoAlpha: 0 }, "frame1")

			.add("frame2", "+=0")
			.from("#opening-2", .4, { ease: "power4.inOut", morphSVG: { shape: "#opening-2-start", shapeIndex: "auto" } }, "frame2")
			.from("#wrinkle-2A", .4, { autoAlpha: 0, y: 0, ease: "power3.inOut", morphSVG: { shape: "#wrinkle-2A-start", shapeIndex: "auto" } }, "frame2")
			.from("#wrinkle-2B", .4, { autoAlpha: 0, y: 0, ease: "power3.inOut", morphSVG: { shape: "#wrinkle-2B-start", shapeIndex: "auto" } }, "frame2")
			.from("#hand-2", .4, { x: 0, y: 98, rotation: 0, scaleY: .2, ease: "power3.inOut" }, "frame2")
			.from("#eyes-2", .4, { y: 30, scale: .5, autoAlpha: 0, transformOrigin: "center", ease: "power4.inOut" }, "frame2+=.1")
			
			.add("frame3", "+=0")
			.from("#bubble-2", .4, { scale: 0, rotation: 15, transformOrigin: "bottom right", ease: "back.out(1.7)" }, "frame3")

			.add("frame4", .5)
			.set("#eye-2R, #eye-2L", { scaleY: .1, transformOrigin: "center", ease: "power4.inOut" }, "frame4")
			.set("#eye-2R, #eye-2L", { scaleY: 1, transformOrigin: "center", ease: "power4.inOut" }, "frame4+=0.2")
			.set("#eye-2R, #eye-2L", { scaleY: .1, transformOrigin: "center", ease: "power4.inOut" }, "frame4+=0.3")
			.set("#eye-2R, #eye-2L", { scaleY: 1, transformOrigin: "center", ease: "power4.inOut" }, "frame4+=0.4")

			;
	}, []);

	const handleMouseEnter = () => {
		if (maintl.current) {
			// If timeline is at the start or reversing, play forward
			if (maintl.current.progress() === 0 || maintl.current.reversed()) {
				maintl.current.reversed(false);  // Clear reversed state
				maintl.current.play();
				setHasPlayed(true);
			}
		}
	};

	const handleMouseLeave = () => {
		if (maintl.current && maintl.current.progress() > 0 && !maintl.current.reversed()) {
			// Play in reverse back to the start
			maintl.current.reverse();
			setHasPlayed(false);
		}
	};

	const handleClick = () => {
		console.log("flash");
	};

	const handleTouchStart = (e) => {
		// Trigger animation on touch
		handleMouseEnter();

		// Set a timer for long press (3500ms)
		touchTimer.current = setTimeout(() => {
			// Long press detected - trigger the modal
			if (onClick) {
				onClick(e);
			}
		}, 3500);

		// Prevent default click behavior
		e.preventDefault();
	};

	const handleTouchEnd = (e) => {
		// Clear the timer if user releases before long press
		if (touchTimer.current) {
			clearTimeout(touchTimer.current);
			touchTimer.current = null;
		}

		// Reverse animation when touch is released
		handleMouseLeave();

		// Prevent default click
		e.preventDefault();
	};

	return (
		<div id={id} className={`float ${className}`} onMouseEnter={handleMouseEnter} onMouseLeave={handleMouseLeave} onTouchStart={handleTouchStart} onTouchEnd={handleTouchEnd} onClick={onClick}>
			<svg id="peekaboo-2" xmlns="http://www.w3.org/2000/svg" width="360.48" height="168.91" viewBox="0 0 360.48 168.91">
				<g id="start-state-2" className="guide">
					<path id="opening-2-start" className="guide" d="M360.48,168.91H121.74c1.17-1.03,95.63-.37,101.57-.53,7.6-.17,31.71-.17,36.06-.33,5.72.5,37.05.39,43.27.39s39.74-.89,57.83.47Z" />
					<path id="wrinkle-2B-start" className="guide" d="M267.12,168.65c-12.88,0-31.38-.17-48.63-.08,4.95-.25,17.92.66,41.2,0,19.32.91,67.62-.33,99.83.08-22.02.22-72.14,0-92.39,0Z" />
					<path id="wrinkle-2A-start" className="guide" d="M231.82,168.76c-42.94.08-99.25,0-108.41.06,12.39-.81,71.5.52,108.41-.06Z" />
				</g>
				<g id="end-state-2">
					<path id="opening-2" d="M360.48,168.91H121.74c4.19-9.44,10.15-17.73,16.79-25.65,20.46-24.42,69.07-80.24,120.85-65.04,37.29,8.7,48.69,48.55,67.18,66.31,9.38,10.59,19.94,16.68,33.92,24.38Z" />
					<g id="eyes-2">
						<path id="whites-2" d="M228.95,139.64c-7.64,7.35-20.91,10.64-27.79.74-9.25-18.5,19.27-41.83,28.83-22.89,3.69-4.51,7.39-7.03,13.17-2.73,13.95,8.67,8.26,42.94-14.21,24.88Z" style={{fill: "#fff"}} />
						<path id="eye-2R" d="M226.86,123.9c-3.2-8.68-14.09-1.47-11.59,6.38,2.79,8.75,15.14,3.26,11.59-6.38Z" />
						<path id="eye-2L" d="M235.26,123.21c-6.47-4.08-8.82,10.11-.79,10.81,4.82-1.11,4.22-8.64.79-10.81Z" />
					</g>
					<path id="hand-2" d="M254.6,78.1c-1.87-3.3-1.59-7.22-.23-7.22,1.15,0,2.63,8.52,5.01,8.15,7.17.4,2.04-11.64,3.85-12.14,1.78-.46,5.66,4.82,2.66,14.93,7.27-2.15,3.43-14.74,6.18-13.78s3.8,8.83-.77,17.46c7.06-.88,4.25-9.72,7.14-9.3.86.34,1.49,7.07-2.7,12.14-.62.62-3.87,4.31-11.69,2.27s-7.6-9.3-9.45-12.51Z" />
					<path id="wrinkle-2B" d="M309.69,111.36c-17.17-46.02-29.28-63.19-90.94-39.63,4.07-2.78,52.18-32.81,74.86-3.96,14.09,15.85,22.68,63.63,48.88,83.23-20.04-13.87-24.66-24.22-32.81-39.63Z" style={{ opacity: .66, fill: "var(--color-black-65)" }}/>
					<path id="wrinkle-2A" d="M231.96,62.04c-42.94-3.74-87.63,60.99-91.82,69.14,9.25-11.89,53.06-63.63,91.82-69.14Z" style={{ opacity: .66, fill: "var(--color-black-65)" }}/>
				</g>
				<g id="bubble-2">
					<path id="bubble-fill-2" d="M171.36,129.99c-1.19.98-2.26,5.5-8.37,5.04-6-.41-47.7-57.57-48.03-57.98-.24-.24-.47-.79-.59-1.21-.18-.71.15-1.09,3.27-3.97,1.88-1.77,4.59-4.27,5.97-5.56,5-4.65,6.45-6.77,8.33-12.21.94-2.74.97-2.91.97-7.8,0-4.33-.09-5.3-.68-7.3-1.27-4.41-3.3-8.03-6.83-12.18-8.36-9.83-20.49-18.01-41.68-21.54-9.98-1.65-16.98-2.06-24.72-1.5-12.86.97-40.86-.72-54.37,34.32-.79,2.38-.94,3.38-1.09,6.86-.29,7.74-.77,21.54,14.61,32.58,6.42,3.83,9.85,6.12,18.8,8.03,9.62,2.06,15.72,4.02,29.58,4.05,12.07.03,14.65-1.28,21.28-3.17,5.09-1.47,9.89-2,12.89-1.47,2.8.5,44,42.29,55.3,52.77.77,2.94.38,5.68-1.24,8.36-.56.91-2.71,1.57-2.68,1.6.06.06,5.06-.14,7.15,3.26,2.09,3.41.39,7.59.82,7.71,1.54-2.15,4.16-4.85,8.86-5.82,6.87-1.41,8.77,1.69,8.77,1.69,0,0-3.47-5.13-2.46-8.45s5.04-3.78,4.78-4.18c-8.65-2.24-9.42-6.14-8.65-11.92Z" style={{fill: "#fff"}} />
					<path id="bubble-outline-2" d="M184.33,141.91c-.12-.24-8.01-2.15-9.45-5.28s-1.56-13.89-1.74-13.89-5.94,12.81-9.79,10.1c-12.5-10.68-44.12-56.64-44.12-56.96,0-.09,1.47-1.44,3.27-2.97,16.11-15.74,13.95-21.99,13.95-26.75-1.15-13.87-9.52-25.65-22.18-34.13C101.44,5.75,89.97,1.65,70.93.15c-2.83-.24-9.8-.18-14.27.09C9.19.74.82,34.54.14,46.62c-2.59,32.2,32.28,45.38,69.27,46.21,22.52-2.17,29.06-6.3,31.48-4.33,3,.68,51.8,48.29,53.15,49.94,1.89,7.51-10.95,9.75-9.92,11.07.26.32,10.59-2.23,13.21,2.8s.98,10.49.98,10.49c0,0,6.16-6.73,11.03-8.01s14.16,4.14,14.16,4.14c0,0-6.97-5.89-5.82-11.74.87-5.04,7.03-4.7,6.65-5.28ZM175.23,146.1c-1.01,3.32,2.46,8.45,2.46,8.45,0,0-1.89-3.11-8.77-1.69-4.7.96-7.31,3.67-8.86,5.82-.43-.12,1.27-4.3-.82-7.71s-7.09-3.21-7.15-3.26c-.03-.03,2.12-.68,2.68-1.6,1.62-2.68,2-5.42,1.24-8.36-11.3-10.48-52.51-52.27-55.3-52.77-3-.53-7.8,0-12.89,1.47-6.62,1.88-9.21,3.2-21.28,3.17-13.86-.03-19.96-1.99-29.58-4.05-8.95-1.91-12.39-4.21-18.8-8.03C2.78,66.49,3.26,52.68,3.55,44.94c.15-3.47.29-4.47,1.09-6.86C18.14,3.05,46.15,4.74,59.01,3.77c7.74-.56,14.75-.15,24.72,1.5,21.19,3.53,33.32,11.71,41.68,21.54,3.53,4.15,5.56,7.77,6.83,12.18.59,2,.68,2.97.68,7.3,0,4.89-.03,5.06-.97,7.8-1.88,5.44-3.33,7.56-8.33,12.21-1.38,1.29-4.09,3.8-5.97,5.56-3.12,2.88-3.44,3.27-3.27,3.97.12.41.35.97.59,1.21.32.41,42.03,57.57,48.03,57.98,6.11.46,7.18-4.06,8.37-5.04-.77,5.78,0,9.69,8.65,11.92.27.41-3.76.86-4.78,4.18Z" />
					<g id="bubble-text-2">
						<path d="M32.46,18.12c2.35-.71,4.27-1.06,5.76-1.06,2.06,0,3.07.71,3.02,2.14-.03,2.86-2.44,5.83-7.22,8.9-.32,1.86-.57,3.57-.74,5.14l-3.58,1.01c.05-.34.22-1.35.53-3.05l1.01-5.4c.77-4.64,1.18-7.2,1.22-7.68ZM35.32,21.77c-.11.43-.22.86-.31,1.27l-.24,1.25c1.42-.69,2.34-1.42,2.74-2.21.05-.11.07-.21.07-.29,0-.26-.19-.38-.58-.38-.35,0-.91.12-1.68.36Z" />
						<path d="M49.93,22.17c-.48.19-1.06.42-1.73.67l-1.7.65c0-.7-.2-1.06-.6-1.06-.56,0-1.11.31-1.66.94-.42.48-.59.94-.53,1.37.05.29.34.43.86.43.29,0,.66-.04,1.13-.12.66-.14,1.24-.22,1.75-.22,1.26,0,2,.44,2.21,1.32.08.27.12.56.12.86-.02.98-.38,2.02-1.1,3.14-.94,1.47-2.27,2.71-3.98,3.72-.9.53-1.78.79-2.64.79-.78,0-1.56-.22-2.33-.67.4-.9,1.02-2.23,1.85-4.01.48.32.99.48,1.54.48.24,0,.5-.03.77-.1.46-.13.91-.3,1.34-.53.61-.34.9-.68.89-1.03.02-.38-.29-.58-.91-.58-.42,0-1.03.09-1.85.26-.82.18-1.43.26-1.85.26-.58,0-1.01-.1-1.3-.31-.58-.4-.82-1.02-.72-1.85.18-1.68,1.26-3.63,3.24-5.86,2-2.27,3.74-3.46,5.21-3.58,1.41-.08,2.12.98,2.14,3.19-.02.53-.06,1.13-.14,1.8Z" />
						<path d="M61.14,22.17c-.48.19-1.06.42-1.73.67l-1.7.65c0-.7-.2-1.06-.6-1.06-.56,0-1.11.31-1.66.94-.42.48-.59.94-.53,1.37.05.29.34.43.86.43.29,0,.66-.04,1.13-.12.66-.14,1.24-.22,1.75-.22,1.26,0,2,.44,2.21,1.32.08.27.12.56.12.86-.02.98-.38,2.02-1.1,3.14-.94,1.47-2.27,2.71-3.98,3.72-.9.53-1.78.79-2.64.79-.78,0-1.56-.22-2.33-.67.4-.9,1.02-2.23,1.85-4.01.48.32.99.48,1.54.48.24,0,.5-.03.77-.1.46-.13.91-.3,1.34-.53.61-.34.9-.68.89-1.03.02-.38-.29-.58-.91-.58-.42,0-1.03.09-1.85.26-.82.18-1.43.26-1.85.26-.58,0-1.01-.1-1.3-.31-.58-.4-.82-1.02-.72-1.85.18-1.68,1.26-3.63,3.24-5.86,2-2.27,3.74-3.46,5.21-3.58,1.41-.08,2.12.98,2.14,3.19-.02.53-.06,1.13-.14,1.8Z" />
						<path d="M72.35,22.17c-.48.19-1.06.42-1.73.67l-1.7.65c0-.7-.2-1.06-.6-1.06-.56,0-1.11.31-1.66.94-.42.48-.59.94-.53,1.37.05.29.34.43.86.43.29,0,.66-.04,1.13-.12.66-.14,1.24-.22,1.75-.22,1.26,0,2,.44,2.21,1.32.08.27.12.56.12.86-.02.98-.38,2.02-1.1,3.14-.94,1.47-2.27,2.71-3.98,3.72-.9.53-1.78.79-2.64.79-.78,0-1.56-.22-2.33-.67.4-.9,1.02-2.23,1.85-4.01.48.32.99.48,1.54.48.24,0,.5-.03.77-.1.46-.13.91-.3,1.34-.53.61-.34.9-.68.89-1.03.02-.38-.29-.58-.91-.58-.42,0-1.03.09-1.85.26-.82.18-1.43.26-1.85.26-.58,0-1.01-.1-1.3-.31-.58-.4-.82-1.02-.72-1.85.18-1.68,1.26-3.63,3.24-5.86,2-2.27,3.74-3.46,5.21-3.58,1.41-.08,2.12.98,2.14,3.19-.02.53-.06,1.13-.14,1.8Z" />
						<path d="M83.46,17.18l-.12,4.25c-1.04.06-2.04.14-3,.22-1.01,4.21-1.68,8.07-2.02,11.59l-3.86,1.01,2.09-12.12c-.43.06-.84.14-1.22.22l-1.2.22-.26-4.25,9.6-1.13Z" />
						<path d="M83.53,30.48c.45,0,.84.12,1.18.37.34.25.51.59.53,1.02,0,.7-.36,1.34-1.09,1.91-.73.57-1.52.85-2.36.85-.46,0-.84-.1-1.13-.31-.37-.26-.56-.6-.58-1.03.03-.7.4-1.35,1.12-1.93.71-.58,1.49-.88,2.34-.88Z" />
						<path d="M89.77,30.48c.45,0,.84.12,1.18.37.34.25.51.59.53,1.02,0,.7-.36,1.34-1.09,1.91-.73.57-1.52.85-2.36.85-.46,0-.84-.1-1.13-.31-.37-.26-.56-.6-.58-1.03.03-.7.4-1.35,1.12-1.93.71-.58,1.49-.88,2.34-.88Z" />
						<path d="M96.01,30.48c.45,0,.84.12,1.18.37.34.25.51.59.53,1.02,0,.7-.36,1.34-1.09,1.91-.73.57-1.52.85-2.36.85-.46,0-.84-.1-1.13-.31-.37-.26-.56-.6-.58-1.03.03-.7.4-1.35,1.12-1.93.71-.58,1.49-.88,2.34-.88Z" />
						<path d="M25.71,40.04c1.57,0,2.73.86,3.48,2.57l-2.59,2.83c-.35-.37-.76-.55-1.22-.55-.8,0-1.63.69-2.5,2.06-.69,1.14-1.14,2.2-1.37,3.19-.1.46-.14.89-.14,1.27-.02,1.03.35,1.72,1.1,2.09.26.13.52.19.79.19.78,0,1.61-.58,2.47-1.75l.72,2.71c-1.52,1.66-3.06,2.5-4.61,2.5s-2.71-.83-3.43-2.5c-.43-.98-.64-2.06-.62-3.26-.02-.88.09-1.82.31-2.81.48-2.02,1.34-3.86,2.59-5.52,1.54-2.02,3.21-3.02,5.02-3.02Z" />
						<path d="M29.96,41.14l4.2-.72c-.77,2.9-1.38,5.54-1.85,7.92l1.9-.38,1.15-6.82,4.22-.72c-1.6,6.21-2.62,11.48-3.07,15.82l-3.89,1.01,1.03-6.19c-.43.1-1.08.23-1.94.41-.29,1.87-.49,3.46-.6,4.78l-3.89,1.01,2.74-16.1Z" />
						<path d="M43.93,44.55c-.13.43-.24.86-.34,1.3l-.24,1.25,3.65-.77-.22,3.14c-1.74.29-3.1.55-4.08.79-.06.3-.12.61-.17.91l-.17.89,4.25-.62-.29,4.22c-2.19.19-4.96.72-8.3,1.58l2.71-16.32,7.56-1.1-.31,4.22c-1.47.13-2.82.3-4.06.5Z" />
						<path d="M55.91,40.04c1.57,0,2.73.86,3.48,2.57l-2.59,2.83c-.35-.37-.76-.55-1.22-.55-.8,0-1.63.69-2.5,2.06-.69,1.14-1.14,2.2-1.37,3.19-.1.46-.14.89-.14,1.27-.02,1.03.35,1.72,1.1,2.09.26.13.52.19.79.19.78,0,1.61-.58,2.47-1.75l.72,2.71c-1.52,1.66-3.06,2.5-4.61,2.5s-2.71-.83-3.43-2.5c-.43-.98-.64-2.06-.62-3.26-.02-.88.09-1.82.31-2.81.48-2.02,1.34-3.86,2.59-5.52,1.54-2.02,3.21-3.02,5.02-3.02Z" />
						<path d="M60.8,41.14l3.91-.72c-.37,1.33-.63,2.38-.79,3.17,1.33-1.15,2.54-2.26,3.62-3.34l2.88,1.87-4.46,3.98,2.47,9.26-4.08,2.18-1.61-8.57c-.46,2.43-.85,4.85-1.15,7.25l-3.55,1.01,2.76-16.1Z" />
						<path d="M85.62,40.18l-.12,4.25c-1.04.06-2.04.14-3,.22-1.01,4.21-1.68,8.07-2.02,11.59l-3.86,1.01,2.09-12.12c-.43.06-.84.14-1.22.22l-1.2.22-.26-4.25,9.6-1.13Z" style={{fill: "red"}} />
						<path d="M87.06,41.14l4.2-.72c-.77,2.9-1.38,5.54-1.85,7.92l1.9-.38,1.15-6.82,4.22-.72c-1.6,6.21-2.62,11.48-3.07,15.82l-3.89,1.01,1.03-6.19c-.43.1-1.08.23-1.94.41-.29,1.87-.49,3.46-.6,4.78l-3.89,1.01,2.74-16.1Z" style={{fill: "red"}} />
						<path d="M97.83,41.14l3.94-.72c-1.58,6.08-2.62,11.35-3.12,15.82l-3.6,1.01,2.78-16.1Z" style={{fill: "red"}} />
						<path d="M111.54,45.17c-.48.19-1.06.42-1.73.67l-1.7.65c0-.7-.2-1.06-.6-1.06-.56,0-1.11.31-1.66.94-.42.48-.59.94-.53,1.37.05.29.34.43.86.43.29,0,.66-.04,1.13-.12.66-.14,1.24-.22,1.75-.22,1.26,0,2,.44,2.21,1.32.08.27.12.56.12.86-.02.98-.38,2.02-1.1,3.14-.94,1.47-2.27,2.71-3.98,3.72-.9.53-1.78.79-2.64.79-.78,0-1.56-.22-2.33-.67.4-.9,1.02-2.23,1.85-4.01.48.32.99.48,1.54.48.24,0,.5-.03.77-.1.46-.13.91-.3,1.34-.53.61-.34.9-.68.89-1.03.02-.38-.29-.58-.91-.58-.42,0-1.03.09-1.85.26-.82.18-1.43.26-1.85.26-.58,0-1.01-.1-1.3-.31-.58-.4-.82-1.02-.72-1.85.18-1.68,1.26-3.63,3.24-5.86,2-2.27,3.74-3.46,5.21-3.58,1.41-.08,2.12.98,2.14,3.19-.02.53-.06,1.13-.14,1.8Z" style={{fill: "red"}} />
						<path d="M53.71,62.41c1.62,0,2.75.9,3.41,2.69.35.93.53,1.94.53,3.05s-.16,2.22-.48,3.46c-.56,2.13-1.53,4.09-2.9,5.88-1.7,2.19-3.48,3.29-5.35,3.29-1.63,0-2.79-.9-3.48-2.69-.32-.88-.48-1.86-.48-2.95s.17-2.26.5-3.53c.56-2.13,1.52-4.09,2.88-5.88,1.68-2.21,3.47-3.31,5.38-3.31ZM52.89,68.05c-.85,0-1.7.69-2.54,2.06-.72,1.07-1.21,2.13-1.46,3.17-.14.54-.22,1.03-.22,1.46,0,.62.15,1.14.46,1.54.35.43.84.65,1.46.65.85,0,1.62-.45,2.3-1.34.54-.7.94-1.54,1.18-2.52.29-1.14.34-2.26.17-3.36-.18-1.1-.62-1.66-1.34-1.66Z" />
						<path d="M59.83,64.14l3.89-.72c-1.06,3.97-1.83,7.54-2.33,10.7l2.16-.91,1.58-9.07,3.89-.72c-1.57,6.22-2.59,11.5-3.07,15.82l-3.62,1.01.46-2.52c-1.28.56-3.2,1.4-5.76,2.52l2.81-16.1Z" />
						<path d="M78.81,63.18l-.12,4.25c-1.04.06-2.04.14-3,.22-1.01,4.21-1.68,8.07-2.02,11.59l-3.86,1.01,2.09-12.12c-.43.06-.84.14-1.22.22l-1.2.22-.26-4.25,9.6-1.13Z" />
						<path d="M78.98,76.5c.53-.06,1,.02,1.42.24.5.24.74.62.74,1.13-.02.7-.38,1.34-1.1,1.92-.59.45-1.23.72-1.92.82-.54.08-1.01.02-1.39-.17-.45-.25-.67-.64-.67-1.15,0-.7.34-1.35,1.03-1.94.56-.46,1.19-.74,1.9-.84ZM81.57,62.34l4.75.82c-1.26,2.26-2.19,4.02-2.78,5.3-.8,1.74-1.51,3.63-2.14,5.66l-3.17-.14,3.34-11.64Z" />
					</g>
				</g>
			</svg>
			
		</div>
	)
};

export default PeekabooTwo;